!function($,gmb){gmb.set_mashup_markers=function(e,a){if("undefined"==typeof a.mashup_markers||!a.mashup_markers)return!1;var t=[];$(a.mashup_markers).each(function(n,o){var r="undefined"!=typeof o.post_type?o.post_type:"",i="undefined"!=typeof o.taxonomy?o.taxonomy:"",s="undefined"!=typeof o.latitude?o.latitude:"",m="undefined"!=typeof o.longitude?o.longitude:"",d="undefined"!=typeof o.terms?o.terms:"",l={action:"get_mashup_markers",post_type:r,taxonomy:i,terms:d,index:n,lat_field:s,lng_field:m};jQuery.post(a.ajax_url,l,function(n){if($.each(n,function(n,r){var i=gmb.set_mashup_marker(e,l.index,r,o,a);i instanceof Marker&&(t[i.marker_data.id]=i)}),"yes"===a.marker_cluster){new MarkerClusterer(e,t)}},"json")})},gmb.set_mashup_marker=function(map,mashup_index,marker_data,mashup_value,map_data){var lat="undefined"!=typeof marker_data.latitude?marker_data.latitude:"",lng="undefined"!=typeof marker_data.longitude?marker_data.longitude:"";if(""==lat||""==lng)return!1;var title="undefined"!=typeof marker_data.title?marker_data.title:"",address="undefined"!=typeof marker_data.address?marker_data.address:"",marker_position=new google.maps.LatLng(lat,lng),marker_icon=map_data.map_params.default_marker,marker_label="",custom_marker_icon="undefined"!=typeof mashup_value.marker?mashup_value.marker:"",custom_marker_img="undefined"!=typeof mashup_value.marker_img?mashup_value.marker_img:"",included_marker_img="undefined"!=typeof mashup_value.marker_included_img?mashup_value.marker_included_img:"";if(included_marker_img)marker_icon=map_data.plugin_url+included_marker_img;else if(custom_marker_img)marker_icon=custom_marker_img;else if(custom_marker_icon.length>0&&custom_marker_icon.length>0){var custom_label="undefined"!=typeof mashup_value.label?mashup_value.label:"";marker_icon=eval("("+custom_marker_icon+")"),marker_label=custom_label}marker_data.featured_img="yes"===mashup_value.featured_img;var marker=new Marker({map:map,position:marker_position,marker_data:marker_data,icon:marker_icon,custom_label:marker_label});return google.maps.event.addListener(marker,"click",function(){gmb.get_mashup_infowindow_content(map,marker,map_data)}),$(document).trigger("gmb.set_mashup_marker",[marker,map,mashup_index,marker_data,mashup_value,map_data]),marker},gmb.get_mashup_infowindow_content=function(e,a,t){e.info_window.close();var n={action:"get_mashup_marker_infowindow",marker_data:a.marker_data};jQuery.post(t.ajax_url,n,function(n){e.info_window.setContent(n.infowindow),e.info_window.updateContent_(),e.info_window.open(e,a,t),"yes"==t.marker_centered&&window.setTimeout(function(){e.info_window.panToView()},300)},"json")},gmb.set_map_directions=function(e,a){$(a.destination_markers).each(function(t,n){var o=new google.maps.DirectionsService,r=new google.maps.DirectionsRenderer,i=$("#directions-panel-"+a.id).find(".gmb-directions-panel-inner");if("undefined"==typeof n.point||"undefined"==typeof n.point[0])return!1;r.setMap(e),"none"!==a.text_directions&&r.setPanel($(i).get(0));var s,m=n.point[0].latitude,d=n.point[0].longitude,l=n.point[0].address;s=l?l:m+","+d;var p=parseInt(n.point.length-1,10);if("undefined"!=n.point[p])var u=n.point[p].latitude,_=n.point[p].longitude,c=n.point[p].address;var g;g=c?c:u+","+_;var f=n.travel_mode.length>0?n.travel_mode:"DRIVING",k=[];$(n.point.slice(1,-1)).each(function(e,a){var t,n=a.latitude,o=a.longitude,r=a.address;t=r?r:n+","+o,k.push({location:t,stopover:!0})});var w={origin:s,destination:g,waypoints:k,optimizeWaypoints:!0,travelMode:google.maps.TravelMode[f]};o.route(w,function(e,a){a==google.maps.DirectionsStatus.OK&&(r.setOptions({preserveViewport:!0}),r.setDirections(e))})}),$("#directions-panel-"+a.id).find(".gmb-directions-toggle").on("click",function(e){e.preventDefault();var a=$(this).parent(".gmb-directions-panel");a.hasClass("toggled")?a.removeClass("toggled").animate({right:"-50%"}):a.addClass("toggled").animate({right:"0%"})})},gmb.set_map_layers=function(e,a){var t=new google.maps.TrafficLayer,n=new google.maps.TransitLayer,o=new google.maps.BicyclingLayer;$(a.layers).each(function(a,r){switch(r){case"traffic":t.setMap(e);break;case"transit":n.setMap(e);break;case"bicycle":o.setMap(e)}})},gmb.set_map_places_search=function(e,a){function t(e,a){var t=document.getElementById(e);google.maps.event.addDomListener(t,"click",function(){r.setTypes(a)})}if("yes"!==a.places_search[0])return!1;var n=$("#google-maps-builder-"+a.id).siblings(".places-search-wrap"),o=n.find("#pac-input").get(0);e.controls[google.maps.ControlPosition.TOP_CENTER].push(n.get(0));var r=new google.maps.places.Autocomplete(o);r.bindTo("bounds",e);var i=new google.maps.Marker({map:e,anchorPoint:new google.maps.Point(0,(-29))});google.maps.event.addListener(r,"place_changed",function(){i.setVisible(!1);var t=r.getPlace();if(!t.geometry)return void window.alert("Autocomplete's returned place contains no geometry");t.geometry.viewport?e.fitBounds(t.geometry.viewport):(e.setCenter(t.geometry.location),e.setZoom(17)),i.setIcon({url:t.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),i.setPosition(t.geometry.location),i.setVisible(!0);var n;t.name&&(n='<p class="place-title">'+t.name+"</p>"),n+=gmb.set_place_content_in_info_window(t),e.info_window.setContent(n),e.info_window.updateContent_(),e.info_window.open(e,i,a),"yes"==a.marker_centered&&window.setTimeout(function(){e.info_window.panToView()},300)});$("#google-maps-builder-"+a.id).siblings(".places-search-wrap").find("#type-selector").get(0);t("changetype-all",[]),t("changetype-address",["address"]),t("changetype-establishment",["establishment"]),t("changetype-geocode",["geocode"])}}(jQuery,window.MapsBuilder||(window.MapsBuilder={}));