var gmb_data;!function(e,t){"use strict";var i,n,o,a,r,d={},s=[],c=new google.maps.DirectionsService;return d.cache=function(){d.$body=e("body")},d.init=function(){d.cache(),e(window).on("load",d.window_load)},d.window_load=function(){d.calc_routes(),d.$body.on("click, focus",".gmb-directions-autocomplete",d.gmb_setup_autocomplete),d.$body.on("cmb2_remove_row",".cmb-type-destination",function(e,t){d.calc_routes()}),d.$body.on("cmb2_add_row",".cmb-type-destination",function(t,i){var n=e(t.currentTarget).find(".empty-row .gmb-destination-fieldset"),o=e(t.currentTarget).find(".cmb-repeat-row").length;parseInt(e(n).data("iterator"));e(n).attr("data-iterator",o),e(n).data("iterator",o),e(t.currentTarget).find(".cmb-repeat-row:last .gmb-directions-autocomplete").focus()}),e("body").on("change",".gmb-travel-mode",function(e,t){d.calc_routes()})},d.gmb_setup_autocomplete=function(){var t=e(this),s=new google.maps.places.Autocomplete(t[0]);s.bindTo("bounds",map),google.maps.event.addDomListener(t[0],"keydown",function(e){13==e.keyCode&&e.preventDefault()}),google.maps.event.addListener(s,"place_changed",function(){var c=t.parents(".cmb-repeatable-grouping").find(".cmb-repeat-row").length;return i=s.getPlace(),n=e(t).parents(".gmb-destination-fieldset").find(".gmb-directions-latitude"),o=e(t).parents(".gmb-destination-fieldset").find(".gmb-directions-longitude"),a=e(t).parents(".gmb-destination-fieldset").find(".gmb-directions-place_id"),r=e(t).parents(".gmb-destination-fieldset").find(".gmb-directions-address"),n.val(i.geometry.location.lat()),o.val(i.geometry.location.lng()),a.val(i.place_id),r.val(i.formatted_address),i.geometry?(1==c&&t.parents(".cmb-type-destination").find(".cmb-add-row-button").trigger("click"),void d.calc_routes()):void alert("Error: Place not found!")})},d.calc_routes=function(){e("#gmb_directions_group_repeat").find(".cmb-repeatable-grouping").each(function(t,i){s[t]&&s[t].setMap(null),s[t]=new google.maps.DirectionsRenderer,s[t].setMap(window.map);var n,o=e(this).find(".cmb-repeat-row"),a=o.first().find(".gmb-directions-latitude").val(),r=o.first().find(".gmb-directions-longitude").val(),d=o.first().find(".gmb-directions-address").val();n=d?d:a+","+r;var l,m=o.last().find(".gmb-directions-latitude").val(),g=o.last().find(".gmb-directions-longitude").val(),u=o.last().find(".gmb-directions-address").val();l=u&&u!==d?u:m!==a&&g!==r?m+","+g:"";var p=e(this).find(".gmb-travel-mode").val(),b=[];o.not(":first").not(":last").each(function(t,i){var n,o=e(this).find(".gmb-directions-address").val(),a=e(this).find(".gmb-directions-latitude").val(),r=e(this).find(".gmb-directions-longitude").val();n=o?o:a+","+r,b.push({location:n,stopover:!0})});var f={origin:n,destination:l,waypoints:b,optimizeWaypoints:!0,travelMode:google.maps.TravelMode[p]};c.route(f,function(e,i){i==google.maps.DirectionsStatus.OK&&(s[t].setOptions({preserveViewport:!0}),s[t].setDirections(e))})})},e(document).ready(d.init),t.GMB_Directions=d,d}(jQuery,window.MapsBuilderAdmin||(window.MapsBuilderAdmin={}));